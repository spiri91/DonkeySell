function productsController(n,t,i,r,u,f,e,o,s,h){n.productName=i.productName;n.cityId=i.city;n.skip=0;n.query="all";n.itemsPerPage=6;n.sortOptions=e.getSortOptions();n.sortBy=n.sortOptions[2];n.count=0;n.currentPage=0;n.totalPages=0;n.loading=!1;n.products=[];n.init=function(){o.fromUrl.indexOf("/product/")>-1&&s.hasState()===!0?n.getLastState():(n.setInitialCriteria(),n.getProducts())};n.getLastState=function(){let t=s.get();n.skip=t.skip;n.query=t.query;n.itemsPerPage=t.itemsPerPage;n.sortBy=n.sortOptions[t.sortByIndex];n.count=t.count;n.currentPage=t.currentPage;n.totalPages=t.totalPages;n.products=t.products};n.setState=function(){let t={};t.skip=n.skip;t.query=n.query;t.itemsPerPage=n.itemsPerPage;t.sortByIndex=n.sortOptions.indexOf(n.sortBy);t.count=n.count;t.currentPage=n.currentPage;t.totalPages=n.totalPages;t.products=n.products;s.set(t)};n.setInitialCriteria=function(){let t=[];if(n.productName!=="allProducts"){let i=new QueryBuilderPart("title",n.productName,n.productName,!0);t.push(i)}if(n.cityId!=="allCities"){let i=new QueryBuilderPart("cityId",n.cityId,n.cityId,null);t.push(i)}t.length>0&&(n.query=u.buildQuery(t))};n.getProducts=function(){n.loading=!0;n.itemsPerPage=n.itemsPerPage?n.itemsPerPage:4;t.queryProducts(n.query,n.itemsPerPage,n.skip,n.sortBy.value,n.sortBy.sortDirection).then(function(t){t.data&&(n.products=t.data.products,n.count=t.data.count,n.calculatePages())},function(t){f.error("An error occured!");n.doSomethingWithError(t)}).finally(function(){n.loading=!1})};n.resetGetProducts=function(){n.skip=0;n.getProducts()};n.showNextProducts=function(){n.skip+=n.itemsPerPage;n.getProducts()};n.calculatePages=function(){let t=n.count/n.itemsPerPage;if(n.totalPages=Math.ceil(t),n.skip===0)n.currentPage=1;else{let t=n.skip/n.itemsPerPage;n.currentPage=Math.floor(t)+1}};n.showPreviousProducts=function(){n.skip!==0&&(n.skip-=n.itemsPerPage,n.getProducts())};n.setProductNavigation=function(){let t=n.products.map(function(n){return n.id});h.setValues(n.query,n.skip,n.sortBy,n.count,t)};n.showProduct=function(t){n.setProductNavigation();n.setState();r.url("/product/"+t)};n.doSomethingWithError=function(n){console.log(n)};n.init()}app.controller("productsController",["$scope","productsService","$routeParams","$location","queryBuilderService","toastr","sortOptionsService","$rootScope","productsStateService","productNavigationService",productsController]);