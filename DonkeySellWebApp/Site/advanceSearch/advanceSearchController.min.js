function advanceSearchController(n,t,i,r,u,f,e,o,s){function h(n){let r=n.getFullYear(),t=(1+n.getMonth()).toString();t=t.length>1?t:"0"+t;let i=n.getDate().toString();return i=i.length>1?i:"0"+i,t+"."+i+"."+r}n.products=[];n.cities=[];n.categories=[];n.selectedCategoryId={};n.selectedCityId={};n.minPrice=100;n.maxPrice=500;n.minDate=new Date;n.maxDate=new Date;n.searchInDescriptionAlso=!1;n.title="";n.endOfList=!1;n.count=0;n.sortOptions=f.getSortOptions();n.sortBy=n.sortOptions[2];n.loading=!1;n.itemsPerPage=5;n.skip=0;n.query="";n.currentPage=0;n.totalPages=0;n.buidQuery=function(){let t=[],i=new QueryBuilderPart("price",n.minPrice,n.maxPrice);if(t.push(i),n.minDate&&n.maxDate){let i=h(n.minDate),r=h(n.maxDate),u=new QueryBuilderPart("datePublished",i,r);t.push(u)}if(!isNaN(n.selectedCityId)){let i=new QueryBuilderPart("cityId",n.selectedCityId,n.selectedCityId);t.push(i)}if(!isNaN(n.selectedCategoryId)){let i=new QueryBuilderPart("categoryId",n.selectedCategoryId,n.selectedCategoryId);t.push(i)}if(n.title){let i=new QueryBuilderPart("title",n.title,n.title,!0,n.searchInDescriptionAlso);t.push(i)}if(n.searchInDescriptionAlso===!0&&n.title){let i=new QueryBuilderPart("description",n.title,n.title,!0);t.push(i)}n.query=u.buildQuery(t)};n.setState=function(){let t={};t.products=n.products;t.selectedCategoryId=n.selectedCategoryId;t.selectedCityId=n.selectedCityId;t.minPrice=n.minPrice;t.maxPrice=n.maxPrice;t.minDate=n.minDate;t.maxDate=n.maxDate;t.searchInDescriptionAlso=n.searchInDescriptionAlso;t.title=n.title;t.endOfList=n.endOfList;t.count=n.count;t.sortByIndex=n.sortOptions.indexOf(n.sortBy);t.itemsPerPage=n.itemsPerPage;t.skip=n.skip;t.query=n.query;t.currentPage=n.currentPage;t.totalPages=n.totalPages;o.set(t)};n.getLastState=function(){let t=o.get();n.products=t.products;n.selectedCategoryId=t.selectedCategoryId;n.selectedCityId=t.selectedCityId;n.minPrice=t.minPrice;n.maxPrice=t.maxPrice;n.minDate=t.minDate;n.maxDate=t.maxDate;n.searchInDescriptionAlso=t.searchInDescriptionAlso;n.title=t.title;n.endOfList=t.endOfList;n.count=t.count;n.sortBy=n.sortOptions[t.sortByIndex];n.itemsPerPage=t.itemsPerPage;n.skip=t.skip;n.query=t.query;n.currentPage=t.currentPage;n.totalPages=t.totalPages};n.getCities=function(){n.cities=n.$parent.cities};n.getCategories=function(){n.categories=n.$parent.categories};n.firstSearch=function(){n.skip=0;n.getProducts()};n.getProducts=function(){n.loading=!0;n.buidQuery();n.itemsPerPage=n.itemsPerPage?n.itemsPerPage:4;t.queryProducts(n.query,n.itemsPerPage,n.skip,n.sortBy.value,n.sortBy.sortDirection).then(function(t){t.data&&(n.products=t.data.products,n.count=t.data.count,n.calculatePages())},function(t){n.endOfList=!0;n.doSomethingWithError(t)}).finally(function(){n.loading=!1})};n.calculatePages=function(){let t=n.count/n.itemsPerPage;if(n.totalPages=Math.ceil(t),n.skip===0)n.currentPage=1;else{let t=n.skip/n.itemsPerPage;n.currentPage=Math.floor(t)+1}};n.resetSkipAndGetProducts=function(){n.skip=0;n.getProducts()};n.showNextProducts=function(){n.skip+=n.itemsPerPage;n.getProducts()};n.showPreviousProducts=function(){n.skip!==0&&(n.skip-=n.itemsPerPage,n.getProducts())};n.init=function(){n.getCategories();n.getCities();n.setDates();e.fromUrl.indexOf("/product/")>-1&&o.hasState()===!0&&n.getLastState()};n.setDates=function(){n.minDate.setDate(n.minDate.getDate()-31);n.maxDate.setDate(n.maxDate.getDate()+1)};n.setProductNavigation=function(){let t=n.products.map(function(n){return n.id});s.setValues(n.query,n.skip,n.sortBy,n.count,t)};n.doSomethingWithError=function(n){console.log(n)};n.showProduct=function(t){n.setProductNavigation();n.setState();i.url("/product/"+t)};n.init()}app.controller("advanceSearchController",["$scope","productsService","$location","othersService","queryBuilderService","sortOptionsService","$rootScope","advanceSearchStateService","productNavigationService",advanceSearchController]);