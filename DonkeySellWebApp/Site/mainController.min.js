function mainController(n,t,i,r,u,f,e,o,s,h,c,l,a,v){n.user={};n.username="";n.favorites=[];n.unreadMessages=[];n.token="";n.productPopups=[];n.cities=[];n.categories=[];n.buildToggler=function(n){return function(){h(n).toggle()}};n.toggleLeft=n.buildToggler("left");n.isOpenLeft=function(){return h("left").isOpen()};n.login=function(){let i=t.open({templateUrl:"Site/login/login.html",controller:"loginController"});i.result.then(function(){n.init()})};n.init=function(){n.token=i.getToken();n.username=o.get("username");n.token&&n.username&&(n.getUser(),n.getFavorites(),n.getUnreadMessages())};n.showErrorMessage=function(n){u.error(n)};n.getUser=function(){i.getUser(n.username).then(function(t){t.data&&(n.user=t.data)},function(t){n.showErrorMessage("Please login again!");n.doSomethingWithError(t)})};n.getFavorites=function(){f.getFavoritesProducts(n.username,n.token).then(function(t){t.data&&(n.favorites=t.data)},function(t){n.doSomethingWithError(t)})};n.getUnreadMessages=function(){i.getUnreadMessages(n.username,n.token).then(function(t){t.data&&(n.unreadMessages=t.data)},function(t){n.doSomethingWithError(t)})};n.postNewProduct=function(){n.token?r.url("/updateCreateProduct/0"):n.askForLogin()};n.showUser=function(){n.token?r.url("/user/"+n.username):n.askForLogin()};n.askForLogin=function(){u.error("Please login first!")};n.getCitiesAndCategories=function(){n.getCities();n.getCategories();v.all([n.getCities(),n.getCategories]).then(()=>{a.$broadcast("citiesAndCategoriesLoaded")})};n.getCities=function(){return e.getCities().then(function(t){t.data&&(n.cities=t.data)},function(t){n.doSomethingWithError(t)})};n.getCategories=function(){return e.getCategories().then(function(t){t.data&&(n.categories=t.data)},function(t){n.doSomethingWithError(t)})};n.removeProductFromFavorites=function(t){f.deleteFromFavoritesProducts(n.username,n.token,t.id).then(function(){u.success("Product removed!");let i=n.favorites.indexOf(t);n.favorites.splice(i,1)},function(t){n.doSomethingWithError(t)})};n.markMessageRead=function(t){i.markMessageRead(n.user.userName,n.token,t.id).then(function(){let i=n.unreadMessages.indexOf(t);n.unreadMessages.splice(i,1)},function(){n.doSomethingWithError(error)});r.url("/product/"+t.productId)};n.goToProduct=function(n){r.url("/product/"+n)};n.doSomethingWithError=function(n){console.log(n)};n.logout=function(){i.signOut();n.user={};n.username=n.token="";n.favorites=n.unreadMessages=[];a.$broadcast("logout");u.success("You logged out!")};n.contactMe=function(){l.show(l.alert().clickOutsideToClose(!0).title("Contact me").textContent("Send me a mail at:  spataru.ionut91@gmail.com").ok("Got it!"))};a.$on("$locationChangeSuccess",function(n,t,i){a.fromUrl=i});n.getCitiesAndCategories();n.init()}app.controller("mainController",["$scope","$uibModal","usersService","$location","toastr","favoritesService","othersService","storageService","$timeout","$mdSidenav","$log","$mdDialog","$rootScope","$q",mainController]);